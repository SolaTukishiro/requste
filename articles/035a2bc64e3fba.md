---
title: "Laravelで案件の編集・更新機能を作りながら、Update処理の流れを理解する"
emoji: "🛠️"
type: "tech"
topics: ["Laravel", "初心者", "個人開発", "CRUD"]
published: true
---
## はじめに
Laravelで個人開発を進める中で、  
今回は **「案件内容の修正（Update）」** 機能 を実装しました。  

Create（新規作成）までは比較的スムーズに進んだのですが、  
Update では  
- ルーティングの書き方
- Controller の引数
- Form から何が送られているのか
- なぜ更新されないのか

など、**混乱するポイント**が一気に増えたので、  
初学者の自分なりに整理してまとめます。

## 今回やりたかったこと

やりたかった流れはとてもシンプルです。

1. 既存案件の編集画面を表示する
2. すでに登録されている内容を input に表示する
3. 内容を修正して送信する
4. DBのデータを更新する

Create画面をコピーすればいけそう、と思っていましたが  
Update には Update 特有の考え方がありました。

### Update処理の全体像（ざっくり）
Laravelでの Update は、次の流れになります。

- Route：どの案件を更新するか（id）を受け取る
- Controller：更新対象のモデルを受け取る
- Model：`update()` メソッドでDBを書き換える

Createとの最大の違いは、

>「新しく作る」ではなく「既存のモデルを操作する」

という点です。

### Route：id を含める必要がある
最初につまずいたのがここでした。

Update では **どの案件を更新するのか** が必要なので、  
Route に id（モデル）を含めます。

```php
Route::patch('/requests/{request}', [RequestController::class, 'update'])->name('requests.update');
```

ここでの `{request}` は、

- URLの一部
- Controller に渡されるモデル

という役割を持っています。

### Controller：引数が2つ必要だった

Controller の update メソッドは、最終的にこうなりました。

```php
public function update(RequestModel $requestModel, Request $request)
{
    $requestModel->update([
        'title' => $request->title,
        'description' => $request->description,
        'status' => $request->status,
        'price' => $request->price,
    ]);

    return redirect()->route('client.requests.index');
}
```

ここで重要なのが引数です。

- $requestModel  
   → URL の {request} から自動で取得された 更新対象の案件
- $request  
  → フォームから送られてきた 入力データ

最初はこの2つが同じ Request に見えて混乱しましたが、  
**役割が全く違う** という点が理解できてから一気に整理できました。

### Model：update() は「この1件」に対して行う

Create のときは
```php
RequestModel::create([...]);
```
でしたが、Update では
```php
$requestModel->update([...]);
```

になります。

つまり、

- Create：クラスに対して新規作成
- Update：取得済みの1件に対して更新

という違いがあります。

### Blade：form の書き方でつまずいた点

編集画面では、form に **idを含める必要がある** ため、  
action は次のようになりました。

```php
<form action="{{ route('client.requests.update', $request) }}" method="POST">
    @csrf
    @method('PATCH')
```

ここでのポイントは、

- HTML の form は PATCH を直接送れない
- Laravel では `@method('PATCH')` で擬似的に対応する

という点です。

### 「変わらない」原因だったポイント
途中で、

- フォームは送信される
- エラーも出ない
- でも更新されない

という状態にハマりました。

原因は、  

- Route と Controller の引数が噛み合っていなかった
- id（モデル）が update に渡っていなかった

という **構造の理解不足** でした。

Update は「動いていないように見えて、実は別の場所がズレている」  
ということが多く、ここが一番つらかったです。

## 学んだことまとめ

今回の Update 実装で理解できたことは以下です。

- Update では 必ず id（モデル）を扱う
- Controller には
  
  - 更新対象のモデル
  - フォーム入力用の Request の2つが必要
- update() は Model のインスタンスに対して呼ぶ
- Create と Update は見た目が似ていても考え方は別物

## おわりに

Create ができたから Update も簡単、と思っていましたが、  
実際には **理解が浅い部分が全部あぶり出される工程** でした。

初学者の自分が調べながら実装した内容のため、  
もし間違いやより良い書き方があれば、  
ぜひご教授いただけると嬉しいです。  